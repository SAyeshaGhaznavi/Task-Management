{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/new-task-management/my-app/src/app/dashboard/admin/members/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport apiClient from '../../../lib/api';\r\nimport { useAuth } from '../../../../../context/authContext';\r\n\r\ninterface User {\r\n  user_id: number;\r\n  user_name: string;\r\n  email: string;\r\n  password: string;\r\n  phone?: string;\r\n}\r\n\r\ninterface Company {\r\n  company_id: number;\r\n  company_name: string;\r\n  company_location: string;\r\n  owner_id: number;\r\n}\r\n\r\ninterface CompanyMember {\r\n  company_id: number;\r\n  user_id: number;\r\n  user_role: string;\r\n}\r\n\r\nexport default function UsersPage() {\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const {user, isAdmin} = useAuth();\r\n  const [company, setCompany] = useState<string | null>(null);\r\n  const [companyid, setCompanyid] = useState<number|null>(null);\r\n  const [email, setEmail] = useState<string|null>(null);\r\n  const [mes, setMes] = useState<string|null>(null);\r\n  const [role, setRole] = useState<string|null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  const fetchUsers = async () => {\r\n    try {\r\n      const data = await apiClient.get(`/company-members/find/by-company/${isAdmin?.company}`);\r\n      setUsers(data);\r\n      const comp:Company = await apiClient.get(`/company/${isAdmin?.company}`);\r\n      console.log(\"Comp: \", comp.company_name);\r\n      setCompany(comp.company_name);\r\n      setCompanyid(comp.company_id);\r\n      console.log(\"Company: \", company);\r\n    } catch (err) {\r\n      setError('Failed to fetch users');\r\n    }\r\n  };\r\n\r\n  const deleteUser = async (id: number) => {\r\n    try {\r\n      await apiClient.delete(`/company-members/${companyid}/${id}`);\r\n      setUsers(users.filter((u) => u.user_id !== id));\r\n    } catch (err) {\r\n      setError('Failed to delete user');\r\n    }\r\n  };\r\n\r\n  const addUser = async (e: React.FormEvent<HTMLFormElement>) => {\r\n  e.preventDefault();\r\n  try {\r\n    const res: User = await apiClient.get(`/users/by-email/${email}`);\r\n    const userid=res.user_id;\r\n    console.log(\"User/email: \",userid, res);\r\n\r\n    if (!email || !companyid) {\r\n      setMes(\"Missing email or company ID\");\r\n      return;\r\n    }\r\n\r\n    await apiClient.post(`/company-members/`, {\r\n      user_id: userid,\r\n      company_id: companyid,\r\n      user_role: role,\r\n    });\r\n\r\n    setMes(\"User added successfully!\");\r\n    setEmail(\"\");\r\n    fetchUsers();\r\n  } catch (error) {\r\n    console.log(\"Error: \", error);\r\n    setMes(\"Cannot add the user\");\r\n  }\r\n};\r\n\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h2 className=\"text-2xl font-semibold mb-6 text-blue-700\">{company}</h2>\r\n      <h2 className=\"text-2xl font-semibold mb-6 text-blue-700\">Company Members</h2>\r\n      {/* <br></br> */}\r\n\r\n      {error && <p className=\"text-red-500 mb-4\">{error}</p>}\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\r\n        {users.map((user) => (\r\n          <div\r\n            key={user.user_id}\r\n            className=\"border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition\"\r\n          >\r\n            <h3 className=\"text-lg font-medium text-gray-800\">{user.user_name}</h3>\r\n            <p className=\"text-sm text-gray-600\">{user.email}</p>\r\n            {user.phone && <p className=\"text-sm text-gray-500 mt-1\">ðŸ“ž {user.phone}</p>}\r\n\r\n            <button\r\n              onClick={() => deleteUser(user.user_id)}\r\n              className=\"mt-3 text-red-600 hover:underline text-sm\"\r\n            >\r\n              Remove from company\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <form onSubmit={addUser} className=\"mt-6 space-y-4\">\r\n      <h4 className=\"text-lg font-semibold\">Add New Member</h4>\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"User email to add\"\r\n        value={email ?? ''}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        className=\"border p-2 w-full\"\r\n      />\r\n      <h4 className=\"text-lg font-semibold\">New Member Role</h4>\r\n      <select\r\n        value={role ?? ''}\r\n        onChange={(e) => setRole(e.target.value)}\r\n        className=\"border p-2 w-full\"\r\n        required\r\n      >\r\n        <option value=\"\" disabled>Select role</option>\r\n        <option value=\"ADMIN\">ADMIN</option>\r\n        <option value=\"MEMBER\">MEMBER</option>\r\n        <option value=\"USER\">EMPLOYEE</option>\r\n      </select>\r\n\r\n      <button type=\"submit\" className=\"bg-green-600 text-white px-4 py-2 rounded\">\r\n        Add\r\n      </button>\r\n      {mes && <p className=\"text-sm text-gray-500\">{mes}</p>}\r\n    </form>\r\n    </div>\r\n    \r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}